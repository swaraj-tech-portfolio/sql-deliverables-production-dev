SQL Toolkit by Scenario

| Question Style                                              | What They Want                   | SQL Tool to Use                                    | Common Mistakes                                        |
|-------------------------------------------------------------|----------------------------------|----------------------------------------------------|--------------------------------------------------------|
| ðŸ§® "Total, average, count" per group                         | Aggregation                      | GROUP BY + aggregate functions like SUM(), COUNT() | Missing GROUP BY or grouping the wrong column          |
| ðŸ“† "Per month, per year, by quarter"                        | Time-series grouping             | DATEPART() or FORMAT() + GROUP BY                  | Grouping by full date instead of month/year            |
| ðŸ¥‡ "Top N", "Highest", "Lowest"                             | Ranking                          | ORDER BY + TOP or ROW_NUMBER()                     | Forgetting ORDER BY in TOP queries                     |
| â±ï¸ "Running totals", "Moving average", "Windowed stats"     | Row-by-row over time or category | SUM() OVER (PARTITION BY ... ORDER BY ...)         | Forgetting PARTITION BY (global instead of per group)  |
| ðŸ“Š "First", "Last", "Nth" record per group                  | First/Last entry                 | ROW_NUMBER() or MIN/MAX with GROUP BY              | Wrong window function or over-complication             |
| ðŸ” "Exists in both", "Only in one"                          | Set comparison                   | INTERSECT, EXCEPT, or HAVING                       | Using IN() instead of comparing sets                   |
| ðŸ“‹ "All rows with extra info" (like totals beside each row) | Analytics + detail               | OVER() functions (e.g. SUM() OVER(...))            | Using GROUP BY instead â€” which removes row details     |
| ðŸ§  "Slow query", "bad performance"                           | Performance tuning                | Index use, EXISTS, avoid scalar UDFs               | Using correlated subqueries, scalar UDFs, or bad joins |


When to Use What â€“ Based on Question Wording
----------------------------------------------

| If Question Says...                       | You Should Think Of...                     | Why                                                                  |
|-------------------------------------------|--------------------------------------------|----------------------------------------------------------------------|
| â€œPer customer, per product, per monthâ€¦â€   | GROUP BY                                   | Youâ€™re summarizing by a key                                          |
| â€œRank, Top 5, Highest spendingâ€¦â€          | ROW_NUMBER() / RANK() / DENSE_RANK()       | Youâ€™re filtering inside a group                                      |
| â€œEach customerâ€™s first/last activityâ€     | ROW_NUMBER() or MIN/MAX                    | MIN() if you only need a date, ROW_NUMBER() if you want the full row |
| â€œRunning total over timeâ€                 | SUM() OVER (PARTITION BY ... ORDER BY ...) | Running totals track accumulation, not just a sum                    |
| â€œCompare who bought from both categoriesâ€ | HAVING COUNT(DISTINCT ...), INTERSECT      | Youâ€™re comparing subsets inside a group                              |
| â€œShow total spent next to each orderâ€     | SUM() OVER(PARTITION...)                   | You want detail + aggregate on the same row                          |
| â€œRemove duplicates / bad dataâ€            | ROW_NUMBER() + DELETE WHERE rn > 1         | Cleanup using window functions                                       |
| â€œFilter rows based on subquery resultâ€    | EXISTS, IN, JOIN, CTE                      | Depends on size, cardinality, and filtering logic                    |


| Summary Cheatsheet            |
|-------------------------------|
| Task Type                     | Use                                           |
| Summary per group             | GROUP BY                                      |
| First/Last row in group       | ROW_NUMBER() + PARTITION BY + filter          |
| Top N                         | ORDER BY + TOP N (with GROUP BY if needed)    |
| Running total                 | SUM(...) OVER (PARTITION BY ... ORDER BY ...) |
| Customers with X and Y        | HAVING COUNT(DISTINCT ...) = 2 or INTERSECT   |
| Comparing groups              | EXISTS, NOT EXISTS, EXCEPT                    |
| Attach aggregates to each row | Window function + OVER()                      |
| Filter dupes / bad            | ROW_NUMBER() and DELETE WHERE rn > 1          |
